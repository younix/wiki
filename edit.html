<!DOCTYPE html>
<html>
<head>
	<title>WebEdit</title>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
	<meta charset="utf-8" />
	<link rel="stylesheet" type="text/css" href="/edit.css" />
	<script src="/commonmark.js" type="text/javascript"></script>
</head>
<body>

<div><a href="">preview</a> <a href="">source</a></div>

<div id="main">
	<h1>WebEdit</h1>
	<form action="/cgi-bin/save" method="post"
	    enctype="application/x-www-form-urlencoded">
		<input type="hidden" name="path" value="_?PAGE_PATH?_" />
		<textarea id="editor" name="content"
		    onkeyup="view(this.value)">_?PAGE_CONTENT?_</textarea>
		<input type="submit" />
	</form>
	<div id="viewer"></div>
	<textarea id="source"></textarea>
</div>

<script type="text/javascript">
var reader = new commonmark.Parser();
var writer = new commonmark.HtmlRenderer();

function view(code) {
	var parsed = reader.parse(code);
	var html = writer.render(parsed);

	document.getElementById("viewer").innerHTML = html;
	document.getElementById("source").value = html;
}

function show(id) {
	var obj = document.getElementById(id);
	if (obj.style.display == "none") {
		obj.style.display = "block";
	} else {
		obj.style.display = "none";
	}
}

view(document.getElementById("editor").value);
</script>
</body>
</html>
